on:
    push:
      branches: [main]

jobs:
    deploy:
        name: Deploy
        runs-on: ubuntu-latest
        steps:
          - name: Check out code
            uses: actions/checkout@v3
            
          - name: Set up Go
            uses: actions/setup-go@v3
            with:
              go-version: '1.24'
              
          - name: Build
            run : scripts/buildprod.sh

          - name: Set up gcloud
            uses: google-github-actions/setup-gcloud@v2
            with:
              version: 'latest'
              project_id: ${{secrets.notely-455909}}
              service_account_key: secrets.GCP_CREDENTIALS
              export_default_credentials: true

          - name: Build and push Docker image
            run: gcloud builds submit --tag us-central1-docker.pkg.dev/notely-455909/notely-ar-repo/notely:latest .